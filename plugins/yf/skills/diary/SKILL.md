---
name: yf:diary
description: Generate diary entries from open chronicles and close them
arguments:
  - name: plan_idx
    description: "Optional plan index to filter chronicles (e.g., 07). Only processes chronicles tagged with plan:<idx>."
    required: false
---

# Chronicler Diary Skill

Generate consolidated diary entries from open chronicle beads.

## Instructions

Use the `yf_diary` agent to:
1. Query all open chronicle beads
2. Group beads by theme/topic
3. Generate diary markdown files
4. Close the processed beads

## Behavior

When invoked with `/yf:diary`:

1. **Query beads**: List all open beads with `ys:chronicle` label (optionally filtered by `plan:<idx>`)
2. **Check chronicle gate**: If `plan_idx` specified, check for open `ys:chronicle-gate` bead. If gate is still open, warn: "Plan still executing â€” diary will capture partial arc. Proceed anyway?" If no gate or gate closed, proceed.
3. **Launch agent**: Use the `yf_diary` agent to process
4. **Generate files**: Create diary entries in `docs/diary/`
5. **Close beads**: Mark processed beads as closed

### Agent Invocation

If `plan_idx` is specified:
```bash
bd list --label=ys:chronicle --label=plan:<idx> --status=open
```

If no `plan_idx`:
```bash
bd list --label=ys:chronicle --status=open
```

The diary agent:
- Reads all matching open chronicle beads
- Groups by theme (may combine related topics)
- Generates markdown diary entries
- Returns JSON with filenames and content

### Diary Entry Format

Filename: `docs/diary/YY-MM-DD.HH-MM.<topic>.md`

```markdown
# Diary Entry: <Title>

**Date**: YYYY-MM-DD HH:MM
**Topics**: feature, planning
**Chronicle IDs**: abc123, def456

## Summary
Consolidated narrative of what was accomplished.

## Decisions
- Key decision 1 and rationale
- Key decision 2 and rationale

## Next Steps
- [ ] Action item 1
- [ ] Action item 2

---
*Generated by chronicler from 2 chronicle beads*
```

## Expected Output

```
Generating diary entries...

Processing 3 open chronicle beads...

Grouping by theme:
- Authentication work: abc123, def456
- Memory investigation: ghi789

Generating diary entries:

[1] docs/diary/26-02-04.14-30.authentication.md
    - Title: User Authentication Implementation
    - Chronicles: abc123, def456
    - Created successfully

[2] docs/diary/26-02-04.14-30.debugging.md
    - Title: Memory Leak Investigation
    - Chronicles: ghi789
    - Created successfully

Closing processed beads...
- abc123: closed
- def456: closed
- ghi789: closed

Diary generation complete!
2 diary entries created from 3 chronicles.
```

## Pre-Push Integration

The diary skill is designed to run before git push:

1. Pre-push hook detects open chronicles
2. Signals to run `/yf:diary`
3. Diary entries are staged with the push
4. Chronicles are closed

## No Open Chronicles

If no open chronicles exist:

```
Generating diary entries...

No open chronicle beads found.
Nothing to add to diary.
```

## Diary Directory

Diary entries are written to `docs/diary/`. This directory is created automatically by preflight, or manually:

```bash
mkdir -p docs/diary
```
