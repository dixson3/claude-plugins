name: "Integration: Dismiss Gate"
setup:
  - "git init"
  - "mkdir -p .claude/rules docs/plans src"
  - "echo '# Test' > CLAUDE.md"
  - |
    cat > docs/plans/plan-01.md <<'EOF'
    # Plan 01: Test
    **Status:** Draft
    EOF
  - "echo '{}' > .claude/settings.json"
  - "git add -A && git commit -m 'init'"

steps:
  - name: "create_gate"
    run: |
      echo '{"plan_idx":"01","plan_file":"docs/plans/plan-01.md"}' > .claude/.plan-gate
    assertions:
      - type: file_exists
        path: ".claude/.plan-gate"

  - name: "verify_blocked"
    prompt: "Create src/test.py with print('test'). Use the Write tool."
    max_turns: 2
    allowed_tools: ["Write"]
    assertions:
      - type: file_not_exists
        path: "src/test.py"

  - name: "dismiss_gate"
    prompt: "Run /yf:dismiss_gate to remove the plan gate."
    max_turns: 5
    allowed_tools: ["Bash", "Read", "Edit", "Write"]
    assertions:
      - type: file_not_exists
        path: ".claude/.plan-gate"

  - name: "verify_unblocked"
    prompt: "Now create src/test.py with print('test'). Use the Write tool."
    max_turns: 3
    allowed_tools: ["Write"]
    assertions:
      - type: file_exists
        path: "src/test.py"
