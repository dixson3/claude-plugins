# Diary Entry: v2.11.0 Development Arc -- State Migration, Chronicle Resilience, and Rule Reorganization

**Date**: 2026-02-13 18:00
**Operator**: James Dixson
**Topics**: feature, planning, v2.11.0, plan-24, plan-25, plan-28
**Chronicle IDs**: marketplace-8ne, marketplace-hx9, marketplace-9vi

## Summary

The v2.11.0 release arc spanned three plans that collectively restructured the yf plugin's internals, hardened its chronicle subsystem, and cleaned up accumulated organizational debt. The work had been building for a while -- the plugin's state files were scattered through `.claude/`, chronicle capture had known reliability gaps, and the flat rule directory was becoming unwieldy.

We started with Plan 24, the foundational change: migrating all yf plugin state from `.claude/` to a dedicated `.yoshiko-flow/` directory. This was a 49-file change touching every script, hook, and skill in the plugin. James made the key architectural decision to split the configuration into two files -- `yf.json` for committable team configuration and `lock.json` for ephemeral session state -- so that teams could share yf settings through git while keeping transient state local. We also dropped the leading dot prefixes from state files (`.plan-gate` became `plan-gate`) since the dedicated directory made hiding unnecessary. The preflight system handled automatic migration from old installs, splitting existing `.claude/yf.json` into the new config and lock components.

Plan 25 followed, addressing gaps in the chronicle subsystem where work could go unrecorded. We added in-progress bead detection to `chronicle-check.sh`, wired plan lifecycle auto-chronicles into `plan-exec.sh` for start/pause/complete transitions, built a `chronicle-staleness.sh` script with a 30-minute periodic nudge in `code-gate.sh`, and integrated staleness checks into `session-end.sh` and `pre-compact.sh`. The nudge was designed fail-open -- chronicle capture is advisory and should never block code edits. A migration cleanup phase also moved dedup files into `.yoshiko-flow/` and fixed orphan cleanup logic.

Plan 28 rounded out the release by reorganizing the rule directory. We moved all 12 rule files from a flat `rules/yf-*.md` layout to `rules/yf/*.md`, dropping the `yf-` prefix since the subdirectory provided the namespace. The symlink computation required a notable fix: `compute_link_target()` was updated to dynamically compute depth from the target path instead of relying on a hardcoded `../../` prefix, making the installation resilient to future directory changes. All 418 assertions passed after the three plans landed.

## Decisions

- **Config/lock split for `.yoshiko-flow/`**: Separated committed team configuration (`yf.json`) from ephemeral session state (`lock.json`). This allows teams to share yf configuration through git while keeping lock state local. The preflight system does NOT create `yf.json` -- only `/yf:setup` does, preserving explicit opt-in.
- **State file dot-prefix removal**: Renamed `.task-pump.json` to `task-pump.json`, `.plan-gate` to `plan-gate`, etc. The leading dots were originally used for hiding files in `.claude/`, but `.yoshiko-flow/` is a dedicated directory where hiding is unnecessary.
- **Dedup files are yf artifacts**: Chronicle dedup tracking files belong in `.yoshiko-flow/` rather than `.beads/` or `.claude/`, since they are yf-specific ephemeral state, not beads data or Claude configuration.
- **Dynamic symlink depth computation**: Rather than hardcoding the relative path prefix for symlinks, `compute_link_target()` counts directory separators in the target path to derive the correct depth. This makes the rule installation resilient to future directory structure changes.
- **Chronicle staleness nudges are fail-open**: The 30-minute periodic nudge in `code-gate.sh` and the staleness checks in session hooks always exit 0. Chronicle capture is advisory -- it should never block code edits or crash a session.
- **Migration cleanup is unconditional**: Old-format artifacts are cleaned up regardless of whether migration was needed, simplifying the logic and ensuring clean state even in edge cases.

## Next Steps

- [ ] Monitor migration path in real-world external projects to verify the `.claude/` to `.yoshiko-flow/` transition is seamless
- [ ] Validate that chronicle staleness nudges fire at appropriate intervals without being disruptive
- [ ] Confirm that the rule subdirectory migration handles edge cases where only some rules were previously installed

---
*Generated by chronicler from 3 chronicle beads*
