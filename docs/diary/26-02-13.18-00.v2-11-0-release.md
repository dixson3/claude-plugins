# Diary Entry: v2.11.0 Development Arc — State Migration, Chronicle Resilience, and Rule Reorganization

**Date**: 2026-02-13 18:00
**Topics**: feature, planning, v2.11.0, plan-24, plan-25, plan-28
**Chronicle IDs**: marketplace-8ne, marketplace-hx9, marketplace-9vi

## Summary

This entry captures the full v2.11.0 release arc across three plans that collectively restructured the yf plugin's internal organization, hardened its chronicle subsystem, and cleaned up accumulated technical debt.

**Plan 24 — State Directory Migration (.claude/ to .yoshiko-flow/)**: The foundational change of the release. All yf plugin state migrated from `.claude/` to a dedicated `.yoshiko-flow/` directory. This was a 49-file change that touched every script, hook, and skill in the plugin. The config/lock split was the key architectural decision: `yf.json` is now committable to git (shared team configuration), while `lock.json` remains gitignored (ephemeral session state). State files had their leading dot prefixes removed (`plan-gate` instead of `.plan-gate`), and the `.gitignore` managed block was reduced since `.yoshiko-flow/` manages its own gitignore internally. The preflight system handles automatic migration from old installs — existing `.claude/yf.json` files are split into config and lock components and moved to the new location. Version bumped from 2.10.0 to 2.11.0. All 364 unit tests passed.

**Plan 25 — Resilient Chronicle Auto-Capture and Migration Cleanup**: This plan addressed gaps in the chronicle subsystem where work could go unrecorded. Five phases of implementation: (1) in-progress beads detection added to `chronicle-check.sh` so that candidates are identified even without git commits, (2) plan lifecycle auto-chronicles wired into `plan-exec.sh` for start/pause/complete transitions, (3) a new `chronicle-staleness.sh` script with integration into `session-end.sh` and `pre-compact.sh` for periodic nudges, (4) a 30-minute periodic chronicle nudge added to `code-gate.sh` with fail-open semantics, and (5) eight new test scenarios bringing the total from 396 to 404 assertions. A migration cleanup phase also moved dedup files into `.yoshiko-flow/`, fixed orphan cleanup logic, and cleaned up `.gitignore` handling — preserving `.claude/.gitignore` when it contains non-yf entries.

**Plan 28 — Rule Subdirectory Reorganization**: Moved all 12 yf rule files from a flat layout (`rules/yf-*.md`) to a subdirectory (`rules/yf/*.md`), dropping the `yf-` prefix from filenames since the subdirectory provides the namespace. The change required updating `preflight.json` sources and targets, and a notable fix to the symlink computation: `compute_link_target()` now dynamically computes depth from the target path instead of using a hardcoded `../../` prefix. The disabled handler was updated to clean both the new `yf/` subdirectory and legacy flat `yf-*.md` files, ensuring clean migration of existing installs. Ten existing test files were updated and two new migration-specific tests were added. All 418 assertions pass.

## Decisions

- **Config/lock split for `.yoshiko-flow/`**: Separated committed team configuration (`yf.json`) from ephemeral session state (`lock.json`). This allows teams to share yf configuration through git while keeping lock state local. The preflight system does NOT create `yf.json` — only `/yf:setup` does, preserving explicit opt-in.
- **State file dot-prefix removal**: Renamed `.task-pump.json` to `task-pump.json`, `.plan-gate` to `plan-gate`, etc. The leading dots were originally used for hiding files in `.claude/`, but `.yoshiko-flow/` is a dedicated directory where hiding is unnecessary.
- **Dedup files are yf artifacts**: Chronicle dedup tracking files belong in `.yoshiko-flow/` rather than `.beads/` or `.claude/`, since they are yf-specific ephemeral state, not beads data or Claude configuration.
- **Dynamic symlink depth computation**: Rather than hardcoding the relative path prefix for symlinks, `compute_link_target()` counts directory separators in the target path to derive the correct depth. This makes the rule installation resilient to future directory structure changes.
- **Chronicle staleness nudges are fail-open**: The 30-minute periodic nudge in `code-gate.sh` and the staleness checks in session hooks always exit 0. Chronicle capture is advisory — it should never block code edits or crash a session.
- **Migration cleanup is unconditional**: Old-format artifacts are cleaned up regardless of whether migration was needed, simplifying the logic and ensuring clean state even in edge cases.

## Next Steps

- [ ] Monitor migration path in real-world external projects to verify the `.claude/` to `.yoshiko-flow/` transition is seamless
- [ ] Validate that chronicle staleness nudges fire at appropriate intervals without being disruptive
- [ ] Confirm that the rule subdirectory migration handles edge cases where only some rules were previously installed

---
*Generated by chronicler from 3 chronicle beads*
