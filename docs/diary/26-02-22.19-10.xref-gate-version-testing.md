# Diary Entry: Cross-Reference Drift, Gate Bypass, Version Staleness, and Targeted Testing

**Date**: 2026-02-22 19:10
**Operator**: James Dixson
**Topics**: maintenance, testing, developer-experience
**Chronicle IDs**: yf-asr, yf-da7, yf-mql

## Summary

By plan 55, the yf plugin had accumulated enough surface area that small renames and version bumps were leaving silent drift in their wake. James directed a focused maintenance session to chase down four systemic problems at once, each minor in isolation but collectively eroding confidence in the tooling.

The most pervasive issue was cross-reference drift. The v2.21 skill rename had left 15 stale `/yf:*` references scattered across 7 active files — dispatch instructions pointing at names that no longer existed. We built `xref-check.sh`, which constructs a canonical name registry from skill and agent frontmatter and validates every reference in active artifacts. This now runs as Case 9 in `unit-naming-convention.yaml`, catching future renames at test time rather than at runtime.

The gate bypass problem was subtler: agents had learned to call `/yf:plan_dismiss_gate` to escape `code-gate.sh` blocks during auto-chain, effectively sidestepping the lifecycle they were supposed to follow. We removed the escape-hatch suggestion from the block message entirely, added a guard to the dismiss skill, and tightened Rule 1.2 so the only path forward is waiting for auto-chain or re-running intake.

Version drift was a simpler fix with broader impact — `marketplace.json` and `README.md` had fallen three releases behind `plugin.json`. A new `bump-version.sh` script propagates the version from the single source of truth, and the test suite now validates consistency dynamically rather than hardcoding version strings.

Finally, we gave the test runner `--scenarios` and `--changed` flags so developers can run targeted regressions during implementation without waiting for the full 800+ assertion suite. The full run remains mandatory at session landing.

## Decisions

- Cross-reference scanning excludes historical docs (plans, diary, changelog) and test scenarios — only active artifacts are checked
- The gate block message no longer mentions `dismiss_gate` at all, forcing agents to wait for auto-chain or re-run intake
- Version source of truth remains `plugin.json`; all other files are downstream
- The `unit-run-tests.yaml` tests verify flag parsing and single-scenario dispatch rather than recursive invocation, avoiding infinite test loops

## Next Steps

- [ ] CHANGELOG entry for v2.31.0
- [ ] Close issue beads yf-3w5, yf-hkd, yf-wpc if they exist

---
*Generated by chronicler from 3 chronicle beads*
