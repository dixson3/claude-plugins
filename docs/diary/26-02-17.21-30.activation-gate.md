# Diary Entry: Plan 42 -- Activation Gate and Beads Dependency Enforcement

**Date**: 2026-02-17 21:30
**Operator**: James Dixson
**Topics**: activation-gate, beads-dependency, plan:42, feature
**Chronicle IDs**: yf-rgd

## Summary

We had been operating the yf plugin in a fail-open posture since its inception -- if something was misconfigured, skills would attempt to run anyway and produce confusing partial results. James decided it was time for a fundamental architectural shift: the plugin needed to be fail-closed, refusing to activate unless every prerequisite was satisfied. Plan 42 codified this as a three-condition activation model (DD-015), requiring that the config file exists, the plugin is explicitly enabled, and beads-cli is installed. Without all three conditions met, everything stays dark.

The implementation touched over 30 files. We rewrote `yf-config.sh` to expose `yf_beads_installed()` and a three-condition `yf_is_enabled()` check, then created a standalone `yf-activation-check.sh` script for JSON-formatted activation status. The preflight system in `plugin-preflight.sh` gained beads dependency checking with distinct exit paths for missing config and missing beads. We updated `preflight.json` to declare the beads dependency explicitly and reworked the setup skill to check for beads before writing config.

The hardest part was propagating the change. We inserted activation guard blocks into 27 SKILL.md files using a Python bulk-insertion script after awk and perl alternatives failed on macOS multiline handling. Rules gained a new Rule 1.0 for the activation gate, and we implemented hybrid beads routing (DD-016) for graceful degradation. Specification additions spanned REQ-034 through REQ-036, FS-040/041, DD-015/016, UC-035/036, and TODO-027/028. The UC numbering had to shift from the plan's UC-029/030 because those were already claimed by the coder capability.

The test suite bore the brunt of the behavioral change: 94 of 696 assertions failed initially because existing tests ran scripts without config present. We added config file creation to 18 test setup blocks, wrote a new `unit-activation.yaml` with 8 cases, and expanded `unit-yf-config.yaml` to 13 cases. All tests passed in the final run, confirming the fail-closed model was solid.

## Decisions

- UC numbering was adjusted from plan-specified UC-029/030 to UC-035/036 because the lower numbers were already occupied by coder capability entries.
- Python was used for bulk guard insertion into 27 SKILL.md files after awk and perl approaches failed on macOS due to multiline handling differences.
- Config file creation was added to all test file setup blocks rather than making yf-config.sh tolerant of missing config, preserving the fail-closed guarantee.

## Next Steps

- [ ] Monitor for any test regressions caused by the activation gate in future plans
- [ ] Verify per-project activation workflow is documented in user-facing README

---
*Generated by chronicler from 1 chronicle bead*
