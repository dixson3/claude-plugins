# Diary Entry: Plan 42 -- Activation Gate and Beads Dependency Enforcement

**Date**: 2026-02-17 21:30
**Topics**: activation-gate, beads-dependency, plan:42, feature
**Chronicle IDs**: yf-rgd

## Summary

Implemented the activation gate for the yf plugin (Plan 42), fundamentally shifting the plugin from fail-open to fail-closed behavior. The three-condition activation model (DD-015) requires: (1) config file exists, (2) plugin is enabled in config, (3) beads-cli is installed. Without all three conditions met, the plugin remains inactive.

Core changes spanned 30+ files. The `yf-config.sh` script was rewritten with `yf_beads_installed()` and a three-condition `yf_is_enabled()` check. A new standalone `yf-activation-check.sh` script provides JSON output for activation status. The preflight system (`plugin-preflight.sh`) gained beads dependency checking, a no-config exit path, and a no-beads inactive path. The `preflight.json` manifest now declares the beads dependency explicitly. The setup skill (`setup/SKILL.md`) checks for beads before writing config, enabling per-project activation via `/yf:setup`.

Activation guard blocks were inserted into 27 SKILL.md files using a Python bulk-insertion script (awk/perl alternatives failed on macOS). Rules were updated with Rule 1.0 (activation gate) and Rule 4.1 (beads skills). Hybrid beads routing (DD-016) was implemented to allow graceful degradation.

Specification additions: REQ-034/035/036, FS-040/041, DD-015/016, UC-035/036, TODO-027/028. UC numbering diverged from the plan (UC-029/030 were already taken by coder capability), so UC-035/036 were used instead.

The test suite required significant rework due to the fail-closed behavioral change: 94 of 696 assertions initially failed because existing tests ran scripts without config. Config file creation was added to 18 test setup blocks. A new `unit-activation.yaml` (8 cases) and updated `unit-yf-config.yaml` (13 cases) were created. All tests passed in the final run.

## Decisions

- UC numbering was adjusted from plan-specified UC-029/030 to UC-035/036 because the lower numbers were already occupied by coder capability entries.
- Python was used for bulk guard insertion into 27 SKILL.md files after awk and perl approaches failed on macOS due to multiline handling differences.
- Config file creation was added to all test file setup blocks rather than making yf-config.sh tolerant of missing config, preserving the fail-closed guarantee.

## Next Steps

- [ ] Monitor for any test regressions caused by the activation gate in future plans
- [ ] Verify per-project activation workflow is documented in user-facing README

---
*Generated by chronicler from 1 chronicle bead*
