# Diary Entry: Plan 0062 â€” Trimming the Fat from yf Plugin Scripts

**Date**: 2026-02-24
**Operator**: James Dixson
**Topics**: script-optimization, bash, jq-batching, dead-code-removal, specifications, plan:0062-71nv1
**Chronicle IDs**: chron-0001-60kp9

## Summary

We had been accumulating small inefficiencies across the yf shell scripts for weeks -- per-field `jq` invocations that could be batched, `sed` calls that bash parameter expansion handles natively, dead functions that nobody calls anymore. James directed Plan 0062 as a focused cleanup pass: six targeted fixes, no new capabilities, just tightening what was already there.

The highest-impact change was batching `jq` calls in `yft_update()` within `plugins/yf/scripts/yf-tasks.sh`. The function had been spawning between two and seven separate `jq` processes per update call -- one for each field mutation. The rewrite accumulates a filter expression and argument array dynamically, then applies everything in a single `jq` invocation that reads the task file directly. Labels still need their own `jq -R -s` pass for CSV-to-array conversion, but the net result dropped from up to seven subshell forks to at most two. The same batching pattern was applied to the vars loop in `yft_mol_wisp()`, which had been running per-variable `jq` calls to build a key-value object.

The smaller fixes were no less satisfying. Two `sed` subshells in `yft_comment()` were replaced with `${raw_comment%%:*}` and `${raw_comment#*: }` -- pure bash, zero forks, and a bonus fix for an edge case where content containing colons could be silently truncated. The dead `yft_mol_show()` function was removed from `yf-tasks.sh` and its orphaned reference in `yf-task-cli.sh` was updated to point at `yft_show`. The prune boolean checkers in `plugins/yf/scripts/yf-config.sh` were collapsed behind a generic `yf_is_prune()` function that takes the check name as a parameter, with the named wrappers kept for backward compatibility. And `plugins/yf/scripts/chronicle-validate.sh` had its boundary-checking logic consolidated from repeated if-else blocks into a loop-driven approach.

On the specification side, the plan added `docs/specifications/IG/script-complexity.md` covering UC-042 through UC-046 for the new patterns. All eight tasks closed clean, and the commit landed as `9f2a16c`.

---
*Generated by chronicler from 1 chronicle entry*
