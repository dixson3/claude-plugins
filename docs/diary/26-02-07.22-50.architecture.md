# Diary Entry: Architecture Insights â€” Claude Code Execution Mechanisms

**Date**: 2026-02-07 22:50
**Topics**: architecture
**Chronicle IDs**: marketplace-yg5

## Summary

During the planning session for Plan 07, several key architectural insights were captured regarding how Claude Code execution mechanisms relate to the beads-based orchestration system.

Three distinct execution mechanisms in Claude Code were identified and differentiated. The **Task tool** (subagent_type) launches specialized agent subprocesses and serves as the dispatch mechanism for matching the right agent to a given bead. **TaskCreate/TaskList** provides shared coordination metadata, functioning like a Kanban board, but does not launch agents and is less capable than beads for tracking work. **Agent Teams** enables multiple independent Claude Code sessions for persistent multi-session coordination, but these sessions are generic rather than specialized.

The relationship between beads and execution was clarified: beads provides the persistent, git-backed DAG of work (with labels, dependencies, and gates), while Task tool subagents serve as the ephemeral execution engine. The task pump reads from `bd ready`, groups work items by their `agent:<name>` label, and dispatches parallel Task tool calls with the appropriate `subagent_type`.

The Solo, Team, and Contributor modes were identified as beads git-flow modes rather than plugin modes. Solo mode uses an unprotected main branch with direct push. Team mode (activated via `bd init --team`) uses a dedicated sync branch (`beads-sync`) in a shared repo. Contributor mode (activated via `bd init --contributor`) uses a fork-based workflow with a separate planning repo and pull requests. The workflows plugin respects whichever mode beads is configured with.

Chronicler integration with plan execution was also mapped out. Chronicle beads captured during execution are tagged with `plan:<idx>`. A chronicle gate bead is created by `plan_to_beads` and closed when the plan completes, allowing the diary agent to see the full arc of progress before generating entries.

Finally, it was established that Agent Teams is an optional overlay rather than the primary dispatch mechanism. The TeammateIdle and TaskCompleted hooks are additive enhancements; the core task pump works without Agent Teams via Task tool subagents alone.

## Decisions

- Task tool subagents are the primary dispatch mechanism for beads execution, not Agent Teams. Agent Teams is an optional enhancement layer.
- TaskCreate/TaskList is not suitable as a replacement for beads tracking; it serves only as lightweight coordination metadata.
- Solo/Team/Contributor are git-flow modes owned by beads, not by the workflows plugin. The plugin adapts to whatever mode is configured.
- Chronicle gating ties diary generation to plan completion, ensuring the diary agent has full context before consolidating entries.

## Next Steps

- [x] Implement the task pump that reads `bd ready` and dispatches via Task tool subagents grouped by `agent:<name>` label
- [x] Define the chronicle gate bead lifecycle within `plan_to_beads` (creation) and plan completion (closing)
- [x] Document the three execution mechanisms and their boundaries in Plan 07
- [x] Ensure the workflows plugin correctly defers to the beads git-flow mode rather than imposing its own branching strategy

---
*Generated by chronicler from 1 chronicle bead*
