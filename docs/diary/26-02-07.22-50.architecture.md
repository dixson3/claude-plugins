# Diary Entry: Architecture Insights â€” Claude Code Execution Mechanisms

**Date**: 2026-02-07 22:50
**Operator**: James Dixson
**Topics**: architecture
**Chronicle IDs**: marketplace-yg5

## Summary

We sat down to plan Plan 07, expecting a straightforward design session for the beads-based orchestration system, but the conversation quickly turned into a deeper architectural excavation. James wanted clarity on how Claude Code's native execution mechanisms mapped onto the beads model before committing to an orchestration design, and what emerged was a sharper picture than we had going in.

The first insight was disentangling three distinct execution mechanisms that Claude Code provides. The Task tool with its `subagent_type` parameter launches specialized agent subprocesses and became the natural dispatch mechanism for matching the right agent to a given bead. TaskCreate and TaskList, by contrast, only provide shared coordination metadata -- a lightweight Kanban board that cannot launch agents and lacks the persistence and labeling that beads already offers. Agent Teams enables multiple independent Claude Code sessions for persistent multi-session coordination, but those sessions are generic rather than specialized. This three-way distinction had been muddy before, and getting it straight shaped the rest of the planning session.

From there, we mapped the relationship between beads and the Task tool. Beads provides the persistent, git-backed DAG of work with labels, dependencies, and gates. Task tool subagents serve as the ephemeral execution engine. The task pump would read from `bd ready`, group work items by their `agent:<name>` label, and dispatch parallel Task tool calls with the appropriate `subagent_type`. This clean separation -- beads owns state, Task tool owns execution -- became a guiding principle.

We also clarified that the Solo, Team, and Contributor modes are beads git-flow modes, not plugin modes. Solo uses an unprotected main branch with direct push. Team mode, activated via `bd init --team`, uses a dedicated sync branch. Contributor mode uses a fork-based workflow. The workflows plugin would respect whichever mode beads is configured with rather than imposing its own branching strategy.

Finally, James confirmed that Agent Teams should be treated as an optional overlay rather than the primary dispatch mechanism. The core task pump works with Task tool subagents alone, and Agent Teams hooks like TeammateIdle and TaskCompleted are additive enhancements layered on top. With these architectural boundaries established, we had a solid foundation for the Plan 07 implementation ahead.

## Decisions

- Task tool subagents are the primary dispatch mechanism for beads execution, not Agent Teams. Agent Teams is an optional enhancement layer.
- TaskCreate/TaskList is not suitable as a replacement for beads tracking; it serves only as lightweight coordination metadata.
- Solo/Team/Contributor are git-flow modes owned by beads, not by the workflows plugin. The plugin adapts to whatever mode is configured.
- Chronicle gating ties diary generation to plan completion, ensuring the diary agent has full context before consolidating entries.

## Next Steps

- [x] Implement the task pump that reads `bd ready` and dispatches via Task tool subagents grouped by `agent:<name>` label
- [x] Define the chronicle gate bead lifecycle within `plan_to_beads` (creation) and plan completion (closing)
- [x] Document the three execution mechanisms and their boundaries in Plan 07
- [x] Ensure the workflows plugin correctly defers to the beads git-flow mode rather than imposing its own branching strategy

---
*Generated by chronicler from 1 chronicle bead*
