# Diary Entry: Plan 27 — Beads Git Workflow Integration (v2.12.0)

**Date**: 2026-02-13 17:52
**Topics**: feature, planning, v2.12.0, plan-27, beads, git-workflow
**Chronicle IDs**: marketplace-1va, marketplace-7bk, marketplace-pbm

## Summary

Completed Plan 27: Beads Git Workflow Integration, which reverses the local-only beads decision from v2.5.0 (Plan 18) and transitions `.beads/` to a git-tracked model with a dedicated `beads-sync` branch strategy. This was a significant architectural change that touched infrastructure scripts, preflight configuration, rules documentation, and test scenarios across five implementation phases.

**Core Implementation**: The `setup-project.sh` script was updated to remove `.beads/` from the managed gitignore block, since beads now manages its own `.beads/.gitignore` internally (tracking `issues.jsonl`, `config.yaml`, `metadata.json`; ignoring `*.db` and daemon files). A new `install-beads-push-hook.sh` script provides an idempotent pre-push hook installer that auto-pushes the `beads-sync` branch alongside whatever branch the user is pushing, with fail-open design. The `preflight.json` setup command was updated to chain `bd init` (without `--skip-hooks`) into sync branch configuration, mass-delete protection, and `bd hooks install`. The `plugin-preflight.sh` gained automatic migration logic that detects legacy local-only deployments and migrates them: configuring the sync branch, enabling mass-delete protection, installing hooks, and running `bd doctor`.

**Rules and Documentation**: The `beads.md` rule file was rewritten from scratch to document the git-tracked model, replacing all local-only guidance with the new `bd sync` workflow and quick reference. README, DEVELOPERS.md, and CHANGELOG were updated for the v2.12.0 version bump.

**Tests**: A new `unit-beads-git.yaml` test file with 9 test cases replaced the old `unit-beads-local.yaml`, covering sync branch configuration, hook installation, migration detection, and gitignore management.

**Chronicle Safety Net (follow-up fix)**: After completing the plan, a gap was discovered: no chronicle had been captured during the Plan 27 implementation itself. The root cause was that the `plan_intake` skill's Step 4 (chronicle capture) was conditional and easy to skip. Two fixes were applied: (1) `plan_intake/SKILL.md` Step 4 was rewritten as REQUIRED rather than conditional, and (2) `code-gate.sh` was extended with a chronicle safety net hook that issues a one-shot warning on the first Edit/Write when a plan has beads but no associated chronicle. This uses a `plan-chronicle-ok` marker file and a fail-open subshell pattern matching the existing beads safety net. Five new test cases were added in `unit-code-gate-chronicle.yaml`.

**Git Hygiene**: The `.beads/` directory was cleaned up to stop tracking ephemeral and regenerable files. The `.beads/.gitignore` was updated with patterns for hooks (deterministic output of `bd hooks install`), `interactions.jsonl` (empty, not part of issue state), and `README.md` (boilerplate regenerated on init).

All 435 unit tests passed. Everything was committed and pushed to main.

## Decisions

- **Reversed local-only decision**: The v2.5.0 (Plan 18) decision to keep `.beads/` local-only was reversed. The beads-sync branch strategy keeps code branches clean while enabling cross-machine and cross-session persistence of issue state through git.
- **Beads manages its own .gitignore**: Rather than using the project-level gitignore, `.beads/.gitignore` handles its own file tracking. This keeps the yf-managed gitignore block simpler and gives beads ownership of its own directory.
- **Pre-push hook with fail-open semantics**: The hook compares local vs remote refs and pushes beads-sync alongside the user's branch. If the hook fails for any reason, the push proceeds normally — beads sync is advisory, not blocking.
- **Structural enforcement over advisory notes**: Chronicle capture enforcement was implemented via hook (`code-gate.sh`) and skill requirement (`plan_intake/SKILL.md`) rather than MEMORY.md notes. Structural enforcement is more reliable than advisory guidance.
- **One-shot warning pattern**: The chronicle safety net warns once per plan (using a marker file), matching the existing beads safety net pattern. This avoids nagging the user on every edit.
- **Mock bd scripts in tests use case/esac pattern matching**: Test mocks differentiate between epic queries and chronicle queries using argument pattern matching, enabling realistic multi-concern test scenarios.

## Next Steps

- [ ] Monitor beads-sync branch strategy in multi-session workflows to verify sync reliability
- [ ] Validate automatic migration for legacy local-only deployments in external projects
- [ ] Confirm chronicle safety net fires appropriately during plan execution without false positives
- [ ] Update plugin cache from v2.11.0 to v2.12.0 when ready

---
*Generated by chronicler from 3 chronicle beads*
