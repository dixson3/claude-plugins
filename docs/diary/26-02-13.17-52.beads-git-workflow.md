# Diary Entry: Plan 27 -- Beads Git Workflow Integration (v2.12.0)

**Date**: 2026-02-13 17:52
**Operator**: James Dixson
**Topics**: feature, planning, v2.12.0, plan-27, beads, git-workflow
**Chronicle IDs**: marketplace-1va, marketplace-7bk, marketplace-pbm

## Summary

We had been living with the local-only beads decision from v2.5.0 (Plan 18) long enough to feel its limitations. Beads data could not survive across machines or sessions, and there was no way to share issue state with collaborators. James decided it was time to reverse that decision and transition `.beads/` to a git-tracked model, using a dedicated `beads-sync` branch strategy to keep code branches clean while enabling persistence through git.

This was a significant architectural change that touched infrastructure scripts, preflight configuration, rules documentation, and test scenarios across five implementation phases. The core work centered on updating `setup-project.sh` to remove `.beads/` from the managed gitignore block, since beads now manages its own `.beads/.gitignore` internally -- tracking `issues.jsonl`, `config.yaml`, and `metadata.json` while ignoring `*.db` and daemon files. We built a new `install-beads-push-hook.sh` script as an idempotent pre-push hook installer that auto-pushes the `beads-sync` branch alongside whatever branch the user is pushing, with fail-open design so sync failures never block real pushes.

The preflight system gained automatic migration logic to detect legacy local-only deployments and transition them: configuring the sync branch, enabling mass-delete protection, installing hooks, and running `bd doctor`. The `beads.md` rule file was rewritten from scratch to document the git-tracked model, replacing all local-only guidance with the new `bd sync` workflow. A new `unit-beads-git.yaml` test file with 9 test cases replaced the old `unit-beads-local.yaml`.

After completing the plan, we discovered a gap in our own process: no chronicle had been captured during the entire Plan 27 implementation. The root cause was that `plan_intake`'s Step 4 (chronicle capture) was conditional and easy to skip. We applied two structural fixes -- making Step 4 in `plan_intake/SKILL.md` REQUIRED rather than conditional, and extending `code-gate.sh` with a chronicle safety net that issues a one-shot warning on the first Edit/Write when a plan has beads but no associated chronicle. Five new test cases covered this safety net. All 435 unit tests passed, and everything was committed and pushed to main.

## Decisions

- **Reversed local-only decision**: The v2.5.0 (Plan 18) decision to keep `.beads/` local-only was reversed. The beads-sync branch strategy keeps code branches clean while enabling cross-machine and cross-session persistence of issue state through git.
- **Beads manages its own .gitignore**: Rather than using the project-level gitignore, `.beads/.gitignore` handles its own file tracking. This keeps the yf-managed gitignore block simpler and gives beads ownership of its own directory.
- **Pre-push hook with fail-open semantics**: The hook compares local vs remote refs and pushes beads-sync alongside the user's branch. If the hook fails for any reason, the push proceeds normally -- beads sync is advisory, not blocking.
- **Structural enforcement over advisory notes**: Chronicle capture enforcement was implemented via hook (`code-gate.sh`) and skill requirement (`plan_intake/SKILL.md`) rather than MEMORY.md notes. Structural enforcement is more reliable than advisory guidance.
- **One-shot warning pattern**: The chronicle safety net warns once per plan (using a marker file), matching the existing beads safety net pattern. This avoids nagging the user on every edit.
- **Mock bd scripts in tests use case/esac pattern matching**: Test mocks differentiate between epic queries and chronicle queries using argument pattern matching, enabling realistic multi-concern test scenarios.

## Next Steps

- [ ] Monitor beads-sync branch strategy in multi-session workflows to verify sync reliability
- [ ] Validate automatic migration for legacy local-only deployments in external projects
- [ ] Confirm chronicle safety net fires appropriately during plan execution without false positives
- [ ] Update plugin cache from v2.11.0 to v2.12.0 when ready

---
*Generated by chronicler from 3 chronicle beads*
