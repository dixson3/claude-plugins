# Diary Entry: Deterministic Chronicles at Plan Lifecycle Boundaries

**Date**: 2026-02-14 16:30
**Operator**: James Dixson
**Topics**: chronicles, plan-lifecycle, reliability
**Chronicle IDs**: marketplace-sk3, marketplace-2a3, marketplace-vkm

## Summary

We had been seeing chronicle capture failures under cognitive load for a while, but the Plan 36 execution made the problem undeniable: `plan_intake` Step 4 was skipped entirely, leaving no chronicle record of the planning session. The root cause was architectural -- chronicle creation depended on agent judgment, and agents reliably skip non-critical steps when under pressure. James wanted a structural guarantee: every plan lifecycle boundary should produce a chronicle bead regardless of what the agent does or does not remember to invoke.

Plan 37 solved this with a hybrid stub-plus-optional-enrichment pattern. We built two new shell scripts: `plan-chronicle.sh` for deterministic chronicle creation at save and intake boundaries, and `chronicle-validate.sh` for post-completion coverage validation with fallback stub creation. The key insight was that agents reliably execute bash commands even under load -- they just skip skill invocations. So we moved the critical action (creating the chronicle bead) into shell scripts and left the optional action (enriching it with richer context) as an agent step.

We wired `plan-chronicle.sh save` into the `exit-plan-gate.sh` hook for deterministic capture at plan save time. The `plan-exec.sh` script already handled start and complete boundaries, so we added `chronicle-validate.sh` there to catch any gaps at completion. Dedup was handled via date-keyed files (`.chronicle-plan-<date>`) rather than bead queries, avoiding race conditions and keeping it fast. Fallback stubs are labeled `ys:chronicle:fallback` for traceability, and the entire system is fail-open -- chronicle scripts always exit 0 to never block plan execution. The existing skill and rule files were updated to shift from "create chronicle" to "enrich existing stub," completing the transition from advisory to structural enforcement.

## Decisions

- Shell scripts over agent instructions for critical lifecycle actions -- agents reliably execute bash commands but skip skill invocations under load
- Dedup via date-keyed files (`.chronicle-plan-<date>`) rather than bead queries -- faster, no race conditions
- Fail-open design throughout -- chronicle scripts always exit 0 to never block plan execution
- Fallback stubs labeled `ys:chronicle:fallback` for traceability

## Changes

- `plugins/yf/scripts/plan-chronicle.sh` -- new deterministic chronicle creator (save/intake boundaries)
- `plugins/yf/scripts/chronicle-validate.sh` -- post-completion coverage validator with fallback creation
- `plugins/yf/hooks/exit-plan-gate.sh` -- added `plan-chronicle.sh save` call
- `plugins/yf/skills/plan_intake/SKILL.md` -- Step 4 now bash command + optional enrichment
- `plugins/yf/skills/plan_execute/SKILL.md` -- Step 4.1 now validate-then-fallback pattern
- `plugins/yf/scripts/plan-exec.sh` -- added `chronicle-validate.sh` on completion
- `plugins/yf/rules/plan-transition-chronicle.md` -- shifted from "create" to "enrich existing stub"
- `plugins/yf/rules/auto-chain-plan.md` -- removed chronicle creation, added enrichment note

## Next Steps

- [ ] Monitor next few plan executions to verify chronicles appear reliably
- [ ] Consider version bump if shipping as a release

---
*Generated by chronicler from 3 chronicle beads*
