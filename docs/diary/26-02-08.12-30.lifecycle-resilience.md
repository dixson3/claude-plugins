# Diary Entry: Deterministic Plan Lifecycle & Chronicle Triggers

**Date**: 2026-02-08 12:30
**Operator**: James Dixson
**Topics**: lifecycle, resilience, planning
**Chronicle IDs**: marketplace-yz1

## Summary

We discovered a fragile dependency in the plan lifecycle system the hard way. During Plan 10's implementation, the entire auto-chain was bypassed because the user exited plan mode with "clear context and bypass permissions," then pasted the plan into a fresh session. Since ExitPlanMode was never called in the new session, the hook never fired, no auto-chain signal appeared, no plan file was saved, no chronicle beads were created, no structured beads hierarchy was built via `plan_to_beads`, and no task pump dispatch occurred. The agent simply implemented everything ad-hoc, completely sidestepping the lifecycle we had built in Plan 08.

This was a real-world failure of the happy-path assumption. The auto-chain worked beautifully when ExitPlanMode fired, but the moment someone pasted a plan into a fresh session or cleared context mid-flow, the entire system went silent. Plan 11 was our response: we created a new `plan-intake.md` rule that acts as a fallback detector. It watches for situations where a plan is being implemented without the auto-chain having fired and redirects through the proper lifecycle -- save plan file, run `plan_to_beads`, start `plan-exec.sh`, then `execute_plan`. This catches pasted plans, plans from new sessions, and any other scenario where ExitPlanMode was not the entry point.

While working on the fix, we also addressed a related gap. The `watch-for-chronicle-worthiness` approach -- the passive rule we had salvaged from the roles plugin -- was not triggering during long implementation sessions. We replaced it with semi-automatic chronicle capture at three deterministic lifecycle boundaries: plan start (triggered by the plan-intake rule), plan completion (triggered by execute_plan), and session close (triggered by the Landing the Plane protocol in BEADS.md). James preferred these deterministic capture points over either fully automatic capture (too noisy) or the fully passive approach (never triggered). The lifecycle system was now resilient to its most common failure mode.

## Decisions

- **Rule over hook**: Considered a PreToolUse hook on Edit/Write to warn about missing lifecycle, but rejected it due to latency cost on every file operation. A rule has zero performance cost and relies on agent compliance, which is acceptable since the auto-chain already handles the happy path.
- **Three capture points**: Rather than making chronicle capture fully automatic everywhere (too noisy) or keeping it fully passive (never triggers), chose three deterministic lifecycle boundaries: plan start (plan-intake rule), plan completion (execute_plan skill), and session close (BEADS.md Landing the Plane step 1.5).
- **Fallback, not replacement**: The plan-intake rule supplements the auto-chain â€” it doesn't replace it. When ExitPlanMode fires normally, the auto-chain still handles everything. The rule only activates when the auto-chain didn't fire.

## Next Steps

- [ ] Validate in a real session: start a new session, paste a plan with "implement this plan", verify plan-intake rule fires
- [ ] Monitor whether chronicle capture at session close is too frequent or produces low-value entries
- [ ] Consider whether the plan-intake rule should also handle partial scenarios (e.g., beads exist but plan isn't executing)

---
*Generated by chronicler from 1 chronicle bead*
