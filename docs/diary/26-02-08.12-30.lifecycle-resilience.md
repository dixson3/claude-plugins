# Diary Entry: Deterministic Plan Lifecycle & Chronicle Triggers

**Date**: 2026-02-08 12:30
**Topics**: lifecycle, resilience, planning
**Chronicle IDs**: marketplace-yz1

## Summary

Diagnosed and fixed a fragile dependency in the plan lifecycle system. During Plan 10 implementation, the entire auto-chain was bypassed because the user exited plan mode with "clear context and bypass permissions," then pasted the plan into a fresh session. Since ExitPlanMode was never called in the new session, the hook never fired, no auto-chain signal appeared, no plan file was saved by the hook, no chronicle beads were created, no structured beads hierarchy was built via `plan_to_beads`, and no task pump dispatch occurred. The agent simply implemented everything ad-hoc.

Created a new `plan-intake.md` rule that acts as a fallback: it detects when a plan is being implemented without the auto-chain having fired and redirects through the proper lifecycle (save plan file → `plan_to_beads` → `plan-exec.sh start` → `execute_plan`). This catches pasted plans, plans from new sessions, and any other scenario where ExitPlanMode wasn't called.

Also added semi-automatic chronicle capture at three lifecycle boundaries — plan start, plan completion, and session close — replacing the entirely passive `watch-for-chronicle-worthiness` approach that never actually triggered during long implementation sessions.

## Decisions

- **Rule over hook**: Considered a PreToolUse hook on Edit/Write to warn about missing lifecycle, but rejected it due to latency cost on every file operation. A rule has zero performance cost and relies on agent compliance, which is acceptable since the auto-chain already handles the happy path.
- **Three capture points**: Rather than making chronicle capture fully automatic everywhere (too noisy) or keeping it fully passive (never triggers), chose three deterministic lifecycle boundaries: plan start (plan-intake rule), plan completion (execute_plan skill), and session close (BEADS.md Landing the Plane step 1.5).
- **Fallback, not replacement**: The plan-intake rule supplements the auto-chain — it doesn't replace it. When ExitPlanMode fires normally, the auto-chain still handles everything. The rule only activates when the auto-chain didn't fire.

## Next Steps

- [ ] Validate in a real session: start a new session, paste a plan with "implement this plan", verify plan-intake rule fires
- [ ] Monitor whether chronicle capture at session close is too frequent or produces low-value entries
- [ ] Consider whether the plan-intake rule should also handle partial scenarios (e.g., beads exist but plan isn't executing)

---
*Generated by chronicler from 1 chronicle bead*
