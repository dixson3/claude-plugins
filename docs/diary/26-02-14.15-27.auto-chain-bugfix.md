# Diary Entry: Fix Auto-Chain and Swarm Lifecycle Not Firing After Plan Acceptance

**Date**: 2026-02-14 15:27
**Operator**: James Dixson
**Topics**: bugfix, auto-chain, swarm, plan-acceptance
**Chronicle IDs**: marketplace-46u

## Summary

We hit a frustrating blocker during a downstream project session: the auto-chain lifecycle was not firing after plan acceptance, which meant swarming never started. James reported that plans were being accepted but nothing happened afterward -- the hook was silently failing to find the plan file.

Debugging revealed two compounding bugs. The first was in `plugins/yf/hooks/exit-plan-gate.sh`. The hook was searching for plan files at the project-local path (`$PROJECT_DIR/.claude/plans/`) when Claude Code actually stores accepted plans globally at `~/.claude/plans/`. We confirmed this by inspecting the real filesystem: over 20 plan files existed in the global directory while zero existed in any project-local directory. The fix was straightforward -- update the hook to look in the correct global location.

The second bug was in `plugins/yf/scripts/plugin-preflight.sh`. Legacy flat-format `yf-*.md` symlinks were only being cleaned during the disabled branch of preflight, not during a full sync. This meant stale symlinks from a prior marketplace rename could persist and interfere with the lifecycle chain. We added the cleanup logic after the stale-symlink-from-lock loop at line 452, mirroring the identical cleanup already present in the disabled branch at lines 157-163.

Both fixes shipped as v2.18.1 with all 567 tests passing. We also wrote a recommended-fixes document to `~/workspace/dixson3/epx/recommended_fixes_to_improve_workflow.md` for the affected downstream project, which had accumulated 11 dangling flat-format symlinks from the prior rename. The root cause -- a wrong assumption about where Claude Code stores plan files -- was the kind of bug that could only surface in real-world usage outside the test harness.

## Decisions

- **Plan file location is global, not per-project**: Claude Code stores accepted plans at `~/.claude/plans/`, not `$PROJECT_DIR/.claude/plans/`. The hook was corrected to reflect this.
- **Patch version bump (2.18.1)**: This was a bugfix, not a feature addition, so a patch increment was appropriate.
- **Legacy cleanup placement**: The cleanup was added in the full-sync path after the stale-symlink-from-lock loop to mirror the identical logic in the disabled branch, keeping both code paths consistent.

## Next Steps

- [ ] Clean up the 11 dangling flat-format symlinks in `~/workspace/dixson3/epx`
- [ ] Verify auto-chain fires correctly end-to-end in a live plan-accept-then-swarm scenario
- [ ] Consider adding a test that validates plan file discovery uses the global path

---
*Generated by chronicler from 1 chronicle bead*
