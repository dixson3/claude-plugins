# Diary Entry: Fix Auto-Chain and Swarm Lifecycle Not Firing After Plan Acceptance

**Date**: 2026-02-14 15:27
**Topics**: bugfix, auto-chain, swarm, plan-acceptance
**Chronicle IDs**: marketplace-46u

## Summary

Two compounding bugs were discovered and fixed that prevented the auto-chain lifecycle from firing after plan acceptance, which in turn blocked swarming from ever starting.

The first bug was in `plugins/yf/hooks/exit-plan-gate.sh`. The hook was searching for plan files at the project-local path (`$PROJECT_DIR/.claude/plans/`) when Claude Code actually stores plans globally at `~/.claude/plans/`. This was confirmed by inspecting the real filesystem: over 20 plan files existed in the global directory while zero existed in any project-local directory. The fix updated the hook to look in the correct global location.

The second bug was in `plugins/yf/scripts/plugin-preflight.sh`. Legacy flat-format `yf-*.md` symlinks were only being cleaned during the disabled branch of preflight, not during a full sync. This meant stale symlinks could persist and interfere with the lifecycle chain. The cleanup logic was added after the stale-symlink-from-lock loop (line 452), mirroring the identical cleanup already present at lines 157-163 in the disabled branch.

Both fixes were shipped as v2.18.1 with all 567 tests passing. A recommended-fixes document was also written to `~/workspace/dixson3/epx/recommended_fixes_to_improve_workflow.md` for the affected downstream project, which had 11 dangling flat-format symlinks from a prior marketplace rename.

## Decisions

- **Plan file location is global, not per-project**: Claude Code stores accepted plans at `~/.claude/plans/`, not `$PROJECT_DIR/.claude/plans/`. The hook was corrected to reflect this.
- **Patch version bump (2.18.1)**: This was a bugfix, not a feature addition, so a patch increment was appropriate.
- **Legacy cleanup placement**: The cleanup was added in the full-sync path after the stale-symlink-from-lock loop to mirror the identical logic in the disabled branch, keeping both code paths consistent.

## Next Steps

- [ ] Clean up the 11 dangling flat-format symlinks in `~/workspace/dixson3/epx`
- [ ] Verify auto-chain fires correctly end-to-end in a live plan-accept-then-swarm scenario
- [ ] Consider adding a test that validates plan file discovery uses the global path

---
*Generated by chronicler from 1 chronicle bead*
