# Diary Entry: Auto-Chain Plan Lifecycle Design

**Date**: 2026-02-08 09:15
**Topics**: planning, architecture
**Chronicle IDs**: marketplace-4ba

## Summary

Designed and implemented Plan 08 to simplify the exit-plan-mode workflow in the workflows plugin. The previous flow required 4 manual steps after designing a plan (engage → exit → beads → execute). The new flow collapses this to a single ExitPlanMode action that auto-chains the full lifecycle.

## Key Decisions

- **Option C (auto-chain states)**: Keep internal states (Draft/Ready/Executing) for pause/resume capability, but auto-chain transitions on the happy path. Rejected simpler alternatives (Option A collapsed steps but lost pause/resume; Option B was too monolithic; Option D just cleaned overlap without reducing steps).

- **Hook + Rule mechanism**: The shell hook (`exit-plan-gate.sh`) handles deterministic work (save plan, create gate, output signal). A behavioral rule (`auto-chain-plan.md`) drives the AI-dependent steps (plan_to_beads, execute_plan). This bridges the gap since hooks can't invoke skills.

- **Plugin dependency boundaries**: workflows MUST NOT depend on chronicler. The chronicle capture reminder lives in a new chronicler rule (`plan-transition-chronicle.md`), composably absent if chronicler isn't installed. Chronicler depends on workflows/roles, not the reverse.

- **Gate timing**: The .plan-gate stays active during the auto-chain since all operations use Bash (bd commands) or gate-exempt paths. Removed at the end by `plan-exec.sh start`.

- **Legacy fallback**: engage_plan Draft section retained but marked legacy. If user explicitly says "engage the plan" (gate already exists), hook exits silently and auto-chain does NOT double-fire.

## What Changed

| File | Change |
|------|--------|
| `exit-plan-gate.sh` | Output now signals "Auto-chaining" with parseable PLAN_IDX/PLAN_FILE |
| `auto-chain-plan.md` | New rule replacing `exit-plan-gate.md` — drives full lifecycle |
| `engage-the-plan.md` | Draft triggers removed, kept Pause/Resume/Complete |
| `engage_plan/SKILL.md` | Draft section annotated as legacy fallback |
| `plan-transition-chronicle.md` | New chronicler rule for planning context capture |
| `unit-exit-plan-gate.yaml` | New test case for auto-chain output format |

## Insights

- The hook-outputs-signal + rule-drives-behavior pattern is reusable for other tool-triggered workflows where shell hooks need to chain AI skills.
- Composable plugin rules (present only when plugin installed) are a clean way to add cross-plugin behavior without coupling.
- The `bd create --type=gate` failed despite being listed in `--help` — worked around by using task type with gate labels. May need bd version upgrade.

---
*Generated by chronicler from 1 chronicle bead*
