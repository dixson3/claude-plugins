# Diary Entry: Auto-Chain Plan Lifecycle Design

**Date**: 2026-02-08 09:15
**Operator**: James Dixson
**Topics**: planning, architecture
**Chronicle IDs**: marketplace-4ba

## Summary

We started the morning session with a clear frustration: the plan lifecycle required four manual steps after designing a plan -- engage, exit, create beads, execute -- and James wanted that collapsed into a single action. Plan 08 was born from this friction, aiming to make ExitPlanMode the sole trigger for the full auto-chain lifecycle.

The design process involved evaluating four options. Option A collapsed the steps but sacrificed pause and resume capability. Option B was a monolithic rewrite that felt risky. Option D merely cleaned up overlap without reducing the step count. We settled on Option C, which keeps the internal Draft/Ready/Executing states for pause and resume but auto-chains the transitions on the happy path, giving us both simplicity and flexibility.

A central design challenge was bridging shell hooks and AI-driven skills. Hooks can run deterministic work -- saving the plan file, creating a gate, outputting a signal -- but they cannot invoke skills directly. We solved this with a two-part mechanism: the shell hook `exit-plan-gate.sh` handles the deterministic work and emits a parseable signal, while a new behavioral rule `auto-chain-plan.md` picks up that signal and drives the AI-dependent steps like `plan_to_beads` and `execute_plan`. This hook-outputs-signal, rule-drives-behavior pattern turned out to be cleanly reusable for other tool-triggered workflows.

James was firm on one boundary: the workflows plugin must not depend on chronicler. We respected this by placing the chronicle capture reminder in a new chronicler-owned rule, `plan-transition-chronicle.md`, which is composably absent if chronicler is not installed. The dependency direction stays clean -- chronicler depends on workflows, never the reverse. With the auto-chain wired up and tested, the four-step ceremony was reduced to a single ExitPlanMode action.

## Key Decisions

- **Option C (auto-chain states)**: Keep internal states (Draft/Ready/Executing) for pause/resume capability, but auto-chain transitions on the happy path. Rejected simpler alternatives (Option A collapsed steps but lost pause/resume; Option B was too monolithic; Option D just cleaned overlap without reducing steps).

- **Hook + Rule mechanism**: The shell hook (`exit-plan-gate.sh`) handles deterministic work (save plan, create gate, output signal). A behavioral rule (`auto-chain-plan.md`) drives the AI-dependent steps (plan_to_beads, execute_plan). This bridges the gap since hooks can't invoke skills.

- **Plugin dependency boundaries**: workflows MUST NOT depend on chronicler. The chronicle capture reminder lives in a new chronicler rule (`plan-transition-chronicle.md`), composably absent if chronicler isn't installed. Chronicler depends on workflows/roles, not the reverse.

- **Gate timing**: The .plan-gate stays active during the auto-chain since all operations use Bash (bd commands) or gate-exempt paths. Removed at the end by `plan-exec.sh start`.

- **Legacy fallback**: engage_plan Draft section retained but marked legacy. If user explicitly says "engage the plan" (gate already exists), hook exits silently and auto-chain does NOT double-fire.

## What Changed

| File | Change |
|------|--------|
| `exit-plan-gate.sh` | Output now signals "Auto-chaining" with parseable PLAN_IDX/PLAN_FILE |
| `auto-chain-plan.md` | New rule replacing `exit-plan-gate.md` — drives full lifecycle |
| `engage-the-plan.md` | Draft triggers removed, kept Pause/Resume/Complete |
| `engage_plan/SKILL.md` | Draft section annotated as legacy fallback |
| `plan-transition-chronicle.md` | New chronicler rule for planning context capture |
| `unit-exit-plan-gate.yaml` | New test case for auto-chain output format |

## Insights

- The hook-outputs-signal + rule-drives-behavior pattern is reusable for other tool-triggered workflows where shell hooks need to chain AI skills.
- Composable plugin rules (present only when plugin installed) are a clean way to add cross-plugin behavior without coupling.
- The `bd create --type=gate` failed despite being listed in `--help` — worked around by using task type with gate labels. May need bd version upgrade.

---
*Generated by chronicler from 1 chronicle bead*
