# Diary Entry: Consolidated Workflows and Chronicler into Unified yf Plugin

**Date**: 2026-02-08 12:47
**Operator**: James Dixson
**Topics**: refactor, consolidation, namespace-migration
**Chronicle IDs**: marketplace-dkw

## Summary

Plan 13 was the biggest structural change we had undertaken so far. James had been feeling the friction of maintaining two separate plugins -- workflows and chronicler -- that were tightly coupled through shared beads infrastructure and overlapping lifecycle concerns. The namespace complexity of invoking `workflows:*` for some things and `chronicler:*` for others, combined with cross-plugin dependency management, had become a drag on development velocity. The decision was to consolidate everything into a single unified plugin called yf (Yoshiko Flow), jumping from the separate workflows v1.7.0 and chronicler v1.3.0 to a unified yf v2.0.0.

The refactoring touched roughly 70 files across creation, modification, and deletion. We moved all 11 skills, 2 agents, 9 rules, 5 hooks, and 2 scripts into the new `plugins/yf/` directory and deleted `plugins/workflows/` and `plugins/chronicler/` entirely, along with the 9 old rule files they had installed into `.claude/rules/`. The namespace migration was thorough: all skill names moved to the `yf:*` prefix, agent names adopted `yf_*`, and rule filenames were standardized to `yf-` in both source and install locations.

We also redesigned the lock file, renaming it from `.claude/plugin-lock.json` to `.claude/yf.json` and reorganizing its JSON structure with a `preflight` nesting layer to reserve the top-level namespace for future state like session or pump tracking. Migration logic was added so the preflight system auto-detects old lock formats and converts them transparently, preserving the full migration chain.

All 143 unit tests passed with zero failures after the consolidation. However, a notable irony emerged during the work: the plan lifecycle orchestration system -- beads, task pump, chronicles, gates -- was not used for its own consolidation. We implemented the changes via ad-hoc background Task tool agents, bypassing `plan_to_beads`, `plan-exec.sh`, task pump dispatch, and chronicle capture entirely. This prompted creation of a separate investigation bead to understand why the orchestration system failed to activate for its own restructuring.

## Decisions

- **Single plugin over two**: Merged workflows and chronicler rather than keeping them separate. The two plugins were tightly coupled (shared beads infrastructure, overlapping lifecycle concerns) and maintaining them separately added namespace complexity without meaningful separation of concerns.
- **`yf:*` namespace for skills**: Chose a short, distinctive prefix (`yf` for Yoshiko Flow) rather than spelling out `yoshiko-flow:*` or keeping the old names. Shorter prefixes reduce friction in skill invocations.
- **`preflight` key nesting in lock file**: Wrapped the lock data under a `preflight` key inside `yf.json` rather than keeping it flat. This reserves the top-level namespace for other state that may be tracked in the future (e.g., session state, pump state) without schema conflicts.
- **Source rule files use `yf-` prefix**: Rule source files in `plugins/yf/rules/` now match their install-target names (e.g., `yf-beads.md` instead of `beads.md`). This eliminates the source-vs-target name mismatch that previously existed and simplifies the preflight mapping.

## Next Steps

- [ ] Investigate why the orchestration system did not activate during its own consolidation (separate bead tracks this)
- [ ] Monitor whether the `yf.json` migration path handles edge cases in real sessions (e.g., corrupted old lock files, partial writes)
- [ ] Consider whether future plugin additions should be folded into `yf` or kept as separate plugins now that the consolidation pattern exists

---
*Generated by chronicler from 1 chronicle bead*
