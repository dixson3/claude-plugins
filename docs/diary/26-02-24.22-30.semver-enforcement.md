# Diary Entry: Plan 0063 â€” Automatic Semver Enforcement on Push

**Date**: 2026-02-24
**Operator**: James Dixson
**Topics**: semver, version-enforcement, pre-push-hook, session-land, specifications, plan:0063-ykk66
**Chronicle IDs**: chron-0001-pws1f, chron-0001-72n5w, chron-0001-a5cp8, chron-0001-l10cd

## Summary

The version number had been stuck at 3.0.0 for six plans. Plans 0057 through 0062 shipped bug fixes, new features, specification additions, test cases, and a new IG document, yet the plugin manifest never moved past the version that Plan 0056's v3.0.0 migration had set. The existing `scripts/bump-version.sh` handled the mechanics of updating version strings across files, but nothing in the workflow enforced that someone actually ran it before pushing. James directed Plan 0063 to close that gap with a blocking pre-push hook and a session-land integration that prompts for the bump at the right moment.

The plan was saved from ExitPlanMode, then ingested and executed in a single session. The core implementation is `plugins/yf/hooks/pre-push-version.sh`, a new PreToolUse hook that fires on `Bash(git push*)`. It reads the current version from `plugins/yf/.claude-plugin/plugin.json`, diffs HEAD against the tracking branch for changes in `plugins/yf/`, and blocks the push (exit 2) if plugin code has changed without a corresponding version bump. The change detection scope is deliberately narrow: scripts, hooks, skills, agents, rules, formulas, and the plugin manifest count as version-worthy changes, while documentation, tests, and root-level files like `CHANGELOG.md` are excluded.

The hook slots into the existing pre-push chain between `pre-push-land.sh` (which blocks on dirty trees and in-progress tasks) and `pre-push-diary.sh` (which advises on open chronicles). The ordering matters: landing prerequisites first, then version enforcement, then advisory warnings. The hook registration was added to `plugins/yf/.claude-plugin/plugin.json` in that position.

The session-land side added a step between the existing Step 8b (completed-plan cleanup) and Step 9 (commit) in `plugins/yf/skills/session_land/SKILL.md`. When plugin code has changed and the version hasn't been bumped, the step presents the operator with a choice -- patch, minor, major, or skip -- then runs `scripts/bump-version.sh` with the chosen version. This catches the version gap before the pre-push hook would block it, turning a hard failure into a guided prompt.

On the specification side, the plan added REQ-048 to the PRD, DD-021 to the EDD, and UC-048 and UC-049 to the implementation guide. A dedicated test scenario at `tests/scenarios/unit-pre-push-version.yaml` covers the five key cases: no changes, blocked push, bumped version, doc-only changes, and yf-disabled bypass. All five tasks closed clean.

## Decisions

- **Narrow change detection scope**: Documentation and test-only changes do not require version bumps. This prevents version churn from non-behavioral changes while still catching every script, hook, skill, agent, and rule modification.
- **Session-land prompt before pre-push block**: Rather than relying solely on the blocking hook (which produces a hard failure), the session-land step offers a guided prompt. The hook remains as a safety net for pushes that bypass session landing.
- **Hook ordering**: Version enforcement runs after landing prerequisites but before advisory hooks, so the operator sees the most actionable blocker first.

## Next Steps

- [ ] Run `scripts/bump-version.sh` to set version 3.1.0 covering Plans 0057-0063
- [ ] Add CHANGELOG entry summarizing the six-plan span of changes
- [ ] Commit Plan 0063 implementation (currently uncommitted on working tree)

---
*Generated by chronicler from 4 chronicle entries*
