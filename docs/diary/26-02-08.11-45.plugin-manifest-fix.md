# Diary Entry: Plugin Manifest Schema Compliance

**Date**: 2026-02-08 11:45
**Topics**: bugfix, plugin-system
**Chronicle IDs**: marketplace-3b2

## Summary

Fixed a plugin installation failure that occurred when users tried to install marketplace plugins via Claude Code's `/plugin` command. The root cause was Claude Code's strict JSON schema validation on `plugin.json` — our custom fields (`dependencies`, `artifacts`) used by the preflight system were rejected as unrecognized keys.

The fix splits plugin configuration into two files: `plugin.json` (official Claude Code schema only) and `preflight.json` (custom preflight config). This preserves the full artifact sync engine while making plugins installable through the standard plugin system.

## Decisions

- **Separate file over removal**: Rather than abandoning the preflight system or trying to nest custom data under an allowed key, we created a companion `preflight.json` file. This is the cleanest separation of concerns — Claude Code owns `plugin.json`, our preflight system owns `preflight.json`.
- **Naming consistency**: Used `preflight.json` to match the existing naming pattern (preflight system, `preflight-wrapper.sh`, `plugin-preflight.sh`).
- **Version stays in plugin.json**: The preflight script still reads `version` from `plugin.json` (it's a valid schema field), only `dependencies` and `artifacts` moved to `preflight.json`.

## Files Changed

- `plugins/workflows/.claude-plugin/preflight.json` (new)
- `plugins/chronicler/.claude-plugin/preflight.json` (new)
- `plugins/workflows/.claude-plugin/plugin.json` (stripped custom fields)
- `plugins/chronicler/.claude-plugin/plugin.json` (stripped custom fields)
- `scripts/plugin-preflight.sh` (reads from preflight.json)
- `tests/scenarios/unit-chronicler-init.yaml` (updated paths)
- `tests/scenarios/unit-plan-intake.yaml` (updated paths)
- `CLAUDE.md` (documentation updated)

## Next Steps

- [x] All 129 unit tests passing
- [x] Both plugins install via `/plugin` command

---
*Generated by chronicler from 1 chronicle bead*
