# Diary Entry: Hybrid idx-hash ID Generation (v2.30.0)

**Date**: 2026-02-22
**Topics**: implementation, id-generation, plan-lifecycle, release
**Chronicle IDs**: yf-48p, yf-6wi, yf-wpi

## Summary

Planned and implemented hybrid idx-hash ID generation for all yf-generated identifiers (plan o7y41, released as v2.30.0). The previous pure 5-char base36 hashes (`PREFIX-xxxxx`) were collision-safe but lacked human-readable ordering. The new `PREFIX-NN-xxxxx` format adds a zero-padded sequential index while preserving the hash suffix for parallel safety — if two agents create entries simultaneously, the differing hashes prevent merge collisions.

The core change was to `yf_generate_id()` in `plugins/yf/scripts/yf-id.sh`, which now accepts an optional scope argument (file or directory path). A new `_yf_next_idx` helper counts existing IDs to determine the next sequential index. Directory scope counts matching files (e.g., `plan-*.md`), file scope counts pattern occurrences within a file, and directory-scan scope counts across all `.md` files in a directory. Without a scope argument, the function produces legacy `PREFIX-xxxxx` format for backward compatibility.

Supporting changes spanned the plan lifecycle and specification tooling: `exit-plan-gate.sh` was updated for new plan naming and `_index.md` generation, sed patterns were corrected in 3 scripts, and `tracker-api.sh` and `spec-sanity-check.sh` were adapted. Three skill/agent docs were updated. An `_index.md` registry was bootstrapped with 54 existing plans to establish creation-order tracking. A new test file `unit-yf-id.yaml` was created with 7 tests covering the ID generation scenarios.

The session also captured broader repository activity from v2.27.0 through v2.29.0 across 12 commits, including hash-based IDs, worktree lifecycle and swarm isolation, beads gitignore allowlist, rules consolidation, prompt quality review, and WorktreeCreate/WorktreeRemove hooks. All 893 tests passed at session close.

## Decisions

- Adopted `PREFIX-NN-xxxxx` as the hybrid format, keeping the hash suffix mandatory so parallel creation remains collision-safe without coordination.
- Zero-padded the index to 2 digits (`%02d`) with automatic expansion past 99, balancing readability with forward compatibility.
- Preserved backward compatibility by making the scope argument optional — callers that omit it get the original hash-only format.

## Next Steps

- [ ] Investigate plan gate bypass issue (yf-3w5)
- [ ] Address version test staleness (yf-hkd)
- [ ] Implement targeted regression testing approach (yf-wpc)

---
*Generated by chronicler from 3 chronicle beads*
