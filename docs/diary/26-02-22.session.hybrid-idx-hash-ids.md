# Diary Entry: Hybrid idx-hash ID Generation (v2.30.0)

**Date**: 2026-02-22
**Operator**: James Dixson
**Topics**: implementation, id-generation, plan-lifecycle, release
**Chronicle IDs**: yf-48p, yf-6wi, yf-wpi

## Summary

We'd been generating plan IDs and specification entries as pure 5-character base36 hashes since the early days of yf — collision-safe across parallel worktrees, but opaque to anyone scanning a directory listing. By plan 54 it was clear that humans needed ordering at a glance. James directed the move to hybrid `PREFIX-NNNN-xxxxx` identifiers: a zero-padded sequential index for readability, a hash suffix for parallel safety.

The core work landed in `yf_generate_id()` inside `plugins/yf/scripts/yf-id.sh`. A new `_yf_next_idx` helper counts existing IDs in a given scope — directory (count matching files), file (count pattern occurrences), or directory-scan (count across all `.md` files) — and produces the next index. The scope argument is optional: callers that omit it still get the legacy `PREFIX-xxxxx` format, preserving backward compatibility without migration.

The ripple effects touched more files than expected. `exit-plan-gate.sh` needed new naming logic and `_index.md` generation, three scripts had sed patterns that assumed the old format, and `tracker-api.sh` and `spec-sanity-check.sh` both parsed IDs that now carried an extra segment. We bootstrapped an `_index.md` registry with all 54 existing plans to establish creation-order tracking going forward.

The session also swept in broader repository activity spanning v2.27.0 through v2.29.0 — twelve commits covering hash-based IDs, worktree lifecycle and swarm isolation, beads gitignore allowlist, rules consolidation, prompt quality review, and WorktreeCreate/WorktreeRemove hooks. All 893 tests passed at session close, and the release shipped as v2.30.0.

## Decisions

- Adopted `PREFIX-NN-xxxxx` as the hybrid format, keeping the hash suffix mandatory so parallel creation remains collision-safe without coordination.
- Zero-padded the index to 2 digits (`%02d`) with automatic expansion past 99, balancing readability with forward compatibility.
- Preserved backward compatibility by making the scope argument optional — callers that omit it get the original hash-only format.

## Next Steps

- [ ] Investigate plan gate bypass issue (yf-3w5)
- [ ] Address version test staleness (yf-hkd)
- [ ] Implement targeted regression testing approach (yf-wpc)

---
*Generated by chronicler from 3 chronicle beads*
